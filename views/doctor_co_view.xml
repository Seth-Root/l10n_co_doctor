<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        
        <!-- Modificando la busqueda de los pacientes anadiendo filtros-->
        <record id="patient_filter" model="ir.ui.view">
        <field name="name">Patient</field>
        <field name="model">doctor.patient</field>
        <field name="arch" type="xml">
        <search string="Search Patient" version="7.0">
            <field name="patient"/>
            <field name="ref"/>
            <field name="insurer"/>
            <separator/>
            <filter name="patient" string="Nombre" domain="[('patient','=',patient)]" help="Nombre" />
            <filter name="ref" string="Identificacion" domain="[('ref','=',ref)]" help="Identificacion" />
            <filter name="insurer" string="Aseguradora" domain="[('insurer','=',insurer)]" help="Aseguradora" />
        </search>
        </field>
        </record>

        <!-- Patient Form View -->
        <record id="view_doctor_patient_form_inherit" model="ir.ui.view">
            <field name="name">Patient</field>
            <field name="model">doctor.patient</field>
            <field eval="7" name="priority"/>
            <field name="inherit_id" ref="doctor.view_doctor_patient_form"/>
            <field name="arch" type="xml">
                <field name="id" invisible="1"/>
                <xpath expr="//field[@name='patient']" position="replace">
                    <label string="Número de Identificación" for="ref" style="width:50%%" class="texto"/>
                    <br></br>
		                  <field name="ref" on_change="onchange_existe(ref)" nolabel="1" default_focus="1" style="width:50%%" />
                    <br></br>


                    <label string="Nombre Paciente" for="nombre" class="texto"/>
	            <br></br>
		              <h2>
                    <group col="2" colspan="6">
                      <field name="lastname" nolabel="1" placeholder="Primer Apellido" />
                      <field name="surname" nolabel="1"  placeholder="Segundo Apellido" />
                      <field name="firstname" nolabel="1" placeholder="Primer Nombre" />
                      <field name="middlename" nolabel="1" placeholder="Segundo Nombre" />
                    </group>
                  </h2>
                </xpath>


                <xpath expr="//div[@name='div_atenderpaciente']" position="after">
                  <div name="div_mensaje" class="oe_form_box_info oe_text_center" attrs="{'invisible': [('ref','!=',False)]}">
                    <b> <span class="oe_e">c</span>Presione ENTER al escribir la identificacion. Si esta registrada, los datos seran cargados.</b>
                  </div>
                </xpath>


                <xpath expr="//group[@name='datos_personales']" position="before">
                  <group>
                    <field name="tdoc"/>
                  </group>
                </xpath>

                <field name="insurer" position="replace" >
                  <field name="insurer" attrs="{'invisible': [('tipo_usuario','=','4')]}"/>
                </field>

                <field name="insurer" position="before" >
                    <field name="tipo_usuario"/>
                </field>

                <field name="deceased" position="after" >
                  <field name="es_profesionalsalud"/>
                </field>

                <field name="sex" position="after" >
                  <field name="estadocivil_id"/>
                  <field name="ocupacion_id"/>
                  <field name="email"/>
                  <field name="telefono"/>
                  <field name="movil"/>
                </field>

                <xpath expr="//group[@name='datos_personales_y_direccion']" position="inside">
                <fieldset class="fieldset_margen">
                  <legend class="texto_legend">Datos de residencia</legend>
                        <group col="2">
                          <field name="state_id"/>
                          <field name="city_id"/>
                          <field name="street"/>
                          <field name="zona" style="width: 45%%"/>
                      </group>
                </fieldset>
                </xpath>

                <xpath expr="//group[@name='datos_personales_y_direccion']" position="inside">
                  <fieldset class="fieldset_margen">
                    <legend class="texto_legend">Datos del Acompañante</legend>
                    <group col="2">
                      <field name="nombre_acompaniante"/>
                      <field name="telefono_acompaniante"/>
                    </group>
                  </fieldset>
                </xpath>

                <xpath expr="//group[@name='datos_personales_y_direccion']" position="inside">
                  <fieldset class="fieldset_margen">
                    <legend class="texto_legend">Datos del Responsable</legend>
                    <group col="2" colspan="2">
                      <field name="nombre_responsable"/>
                      <field name="telefono_responsable"/>
                      <field name="parentesco_id"/>
                    </group>
                  </fieldset>
                </xpath>

                <xpath expr="/form[@string='Patient']/sheet/notebook[@colspan='4']/page[1]/field[@name='attentions_ids']/form[@string='Attentions']" position="replace"/>

            </field>
        </record>

        <!-- Patient Tree View -->
        <record id="view_doctor_patient_tree_inherit" model="ir.ui.view">
            <field name="name">Patient</field>
            <field name="model">doctor.patient</field>
            <field eval="7" name="priority"/>
            <field name="inherit_id" ref="doctor.view_doctor_patient_tree"/>
            <field name="arch" type="xml">
              <field name="sex" position="before">
                    <field name="tdoc" string="Tipo doc"/>
                    <field name="ref" string="Nº doc"/>
              </field>
              <field name="ref" position="after">
                <field name="nombre" string="Nombre Paciente"/>
              </field>

            </field>
          </record>

        <!-- appointment Form View -->
        <record id="view_doctor_appointment_form_inherit" model="ir.ui.view">
            <field name="name">Appointment</field>
            <field name="model">doctor.appointment</field>
            <field eval="7" name="priority"/>
            <field name="inherit_id" ref="doctor.view_doctor_appointment_form"/>
            <field name="arch" type="xml">

                <xpath expr="//form/group/field[@name='patient_id']" position="replace">
                    <field name="patient_id" on_change="onchange_patient(patient_id,insurer_id,tipo_usuario_id,ref)"/>
                </xpath>

                <field name="patient_id" position="after" >
                    <field name="ref"/>
                </field>

                <field name="insurer_id" position="after" >
                    <field name="tipo_usuario_id"/>
                </field>


                <field name="type_id" position="attributes">
                    <attribute name="on_change">onchange_calcular_hora(schedule_id,type_id,time_begin)</attribute>
                </field>

            </field>
        </record>



        <!-- schedule Form View -->
        <record id="view_doctor_schedule_form_inherit" model="ir.ui.view">
            <field name="name">Schedule</field>
            <field name="model">doctor.schedule</field>
            <field eval="7" name="priority"/>
            <field name="inherit_id" ref="doctor.view_doctor_schedule_form"/>
            <field name="arch" type="xml">

                <field name="patient_id" position="replace">
                    <field name="patient_id" on_change="onchange_patient(patient_id,insurer_id,tipo_usuario_id)"/>
                </field>

                <field name="patient_id" position="after" >
                    <field name="ref"/>
                </field>

                <field name="insurer_id" position="after" >
                    <field name="tipo_usuario_id"/>
                </field>

                <field name="professional_id" position="replace" >
                    <field name="professional_id" required="True"/>
                </field>
            </field>
        </record>


        <!-- Modificando la busqueda en atencion anadiendo cambios -->
        <record id="attentions_filter" model="ir.ui.view">
        <field name="name">Attentions</field>
        <field name="model">doctor.attentions</field>
        <field name="arch" type="xml">
        <search string="Search Attentions" version="7.0">
            <field name="patient_id"/>
            <field name="professional_id"/>
            <field name="speciality"/>
            <field name="diseases_ids"/>
            
            <separator/>
            <filter name="patient_id" string="Nombre" domain="[('patient_id','=',patient_id)]" help="Nombre" />

            <filter name="professional_id" string="Doctor" domain="[('professional_id','=',professional_id)]" help="Doctor" />

            <filter name="speciality" string="Especialidad" domain="[('speciality','=',speciality)]" help="Especialidad" />

            <filter name="diseases_ids" string="Diagnostico" domain="[('diseases_idsdiseases_ids','=',diseases_ids)]" help="Diagnostico" />

        </search>
        </field>
        </record>

        <!-- Attentions Form View -->
        <record id="view_doctor_attentions_form_inherit" model="ir.ui.view">
            <field name="name">Attentions</field>
            <field name="model">doctor.attentions</field>
            <field eval="7" name="priority"/>
            <field name="inherit_id" ref="doctor.view_doctor_attentions_form"/>
            <field name="arch" type="xml">

                <xpath expr="//form/group/group" position="after">
                <group colspan='2' >
                    <field name="finalidad_consulta"/>
                </group>
                <group colspan="2">
                	<field name="causa_externa" />
                </group>
                </xpath>

                <field name="review_systems_id" position="after">
                    <label for="otro_sintomas_revision_sistema" string="Otros Síntomas"/>
                    <field name="otro_sintomas_revision_sistema"/>
                </field>

                <field name="attentions_past_ids" position="after">
                    <label for="otros_antecedentes" string="Otros Antecedentes"/>
                    <field name="otros_antecedentes" />
                </field>


                <field name="pathological_past" position="after">
                    <label for="otros_antecedentes_patologicos" string="Otros Antecedentes Patológicos"/>
                    <field name="otros_antecedentes_patologicos"/>
                </field>

                <field name="drugs_past" position="after">
                    <label for="otros_antecedentes_patologicos" string="Otros Antecedentes farmacológicos"/>
                    <field name="otros_antecedentes_farmacologicos"/>
                </field>

                
                <field name="attentions_exam_ids" position="after">
                    <label for="otros_hallazgos_examen_fisico" string="Otros hallazgos y signos clínicos en el examen físico"/>
                    <field name="otros_hallazgos_examen_fisico" />
                </field>

                <field name="analysis" position="after">
                    <label for="reportes_paraclinicos" string="Reportes de Paraclínicos"/>
                    <field name="reportes_paraclinicos" nolabel="1"/>
                </field>

                <xpath expr="//notebook/page[@string='Others']" position="after">
                    <page string="Recomendaciones">
                    <separator string="Añadir Recomendaciones" colspan="4"/>       
                    <field name='recomendaciones_ids' nolabel="1" placeholder="Plantilla" widget="many2many_tags"/>
                    <separator string="Crear Recomendaciones" colspan="4"/>
                        <button
                            type="object" name="llamar_wizzard" string="Crear Recomendación" class="oe_link"
                            help="Crear Recomendaciones"/>
                    </page> 
                </xpath>

                <xpath expr="//notebook/page[@string='Others']" position="inside">
                    <page string="Certificados">
                        <separator string="Certificados" colspan="4"/>
                        <field name="certificados_ids" nolabel="1" context="{'professional_id' : professional_id}">
                            <form string="Certificados">
                                <group colspan='3' col='2'>
                                    <field name="name"/>
                                     <field name="expedicion_certificado"/>
                                     <field name="asunto" placeholder="El Dr. Certifica Qué"/>
                                     <field name="professional_id"/>
                                     <field name="cuerpo"/>
                                     <field name="plantilla_id" on_change="onchange_plantillas(plantilla_id)"/>
                                </group>   
                            </form>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>  

        <record model="ir.ui.view" id="wizard_recomendaciones_form">
        <field name="name">wizard_recomendaciones.form</field>
        <field name="model">doctor.attentions.recomendaciones</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Recomendaciones" version="7.0">          
                <group colspan='1' col='2'>
                    <field name="name" />
                    <field name="patient_id" /> 
                    <field name="professional_id" /> 
                </group>
                <field name="cuerpo" /> 
                <footer>
                    <group class="oe_right" col="1">
                        <button type="object" name="create" string="Guardar como una nueva Plantilla" class="oe_link" help="Save as a new template"/>
                    </group>
                </footer>
            </form>
        </field>
        </record>

    <!-- invoice Form View -->
        <record id="invoice_form_view_inherit_doctor_co_invoice" model="ir.ui.view">
            <field name="name">Doctor Invoice</field>
            <field name="model">account.invoice</field>
            <field eval="7" name="priority"/>
            <field name="inherit_id" ref="doctor.invoice_form_view_inherit_doctor_invoice"/>
            <field name="arch" type="xml">
                <field name="patient_id" position="after">
                    <field name="ref"/>
                    <field name="tipo_usuario_id"/>
                </field>
            </field>
        </record>

    <!-- sales order Form View -->
        <record id="sales_order_form_view_inherit_doctor_co_sales_order" model="ir.ui.view">
            <field name="name">Doctor Sales Order</field>
            <field name="model">sale.order</field>
            <field eval="7" name="priority"/>
            <field name="inherit_id" ref="doctor.sales_order_form_view_inherit_doctor_sales_order"/>
            <field name="arch" type="xml">

                <field name="patient_id" position="after">
                    <field name="ref"/>
                    <field name="tipo_usuario_id"/>
                </field>

            </field>
        </record>
    </data>
</openerp>
